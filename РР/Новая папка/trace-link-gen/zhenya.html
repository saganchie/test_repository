<html>
  <head>
    <title>TEST</title>
    <script type="text/javascript" src="pako.js"></script>
    <script type="text/javascript">
      var maxInput =
        'https://trace.ati.su/?Cities=0_145436_-157.9429439,-156.1284423_Вышневолоцкий район, деревня Ненорово, территория промышленная зона кирпичного завода, дом 1, офис 1~1_234552_-155.5128466,-136.9689639_Карачаровская металлобаза, заезд с 1-го Вязовского проезда (Рязанский пр-т, 14, повороот на светофор~2_656467_-156.9680274,-160.6629320_Заводоуковский район, пос.Комсомольский, ул. Трудовая, дом.2, территория &quot;Загрос&quot;(Заводоук~3_180977_-154.9456190,-182.9200520_п. Шушары, Московское шоссе, участок 30, Логопарк &#171;Колпино&#187;, строение №3. (Колпинское шосс~4_112333_-154.6472797,-183.2910151_Новорязанское шоссе, 7 км. от МКАД, складской комплекс ТЛК Томилино, Московская область, Люберецкий~5_778584_-148.5059974,-135.0618000_Смоленская обл.-Грозный на 27 августа 2 точки загрузки:П. Красный 18 пал.Г. Вязьма 9 пал.Вес 22~6_432673_-146.9900366,-142.7345726_поселение Московский , 22й километр Киевского Шоссе, БП &quot;Румянцево&quot; Корпус Г пандус 6, по~7_156743_-155.3640151,-137.9935980_Олимпийский проспект д.48 кор. 4 (заезд с Транспортной улице) вывеска <Главный материальный склад>~8_664788_55.4753420_Октябрьская улица, 36 рабочий посёлок имени Цюрупы, городской округ Воскресенск, Московская област~9_089778_-137.7243042_пос. Новониколаевский, ул.Овражная 4, Индустриальный парк "М7", КПП №2, ООО "ОЛИМП", участок №215~10_155971_-159.5390566_Балахнинский район территория бывшей птицефабрики,строение №27 ,заезд с трассы Н Новгород-Иваново~11_426065_-130.8770752_Московская обл., Ленинский р-н, Видное, деревня Апаринки, владение 9.Логистический парк Апаринки~12_724848_-153.6110057_Свердловская обл, Верхняя Пышма, поселок Залесье, Индустриальный проезд, дом 1 корпус 2~13_886337_-147.3697853_Краснодарский край, Краснодар, поселок Индустриальный, ул Восточная, дом 1А~14_618732_-158.3837184_д. Машково, Промзона, Машковский проезд д. 7, Коор. 55.678893, 37.981270~15_561736_-133.9469600_Респ Северная Осетия - Алания, Владикавказ, ул Генерала Дзусова, дом 16~16_500994_-159.5578978_Мытищинская Ярмарка, пересечение МКАД и Осташковского ш. Ангар № ДС-08~17_117520_-130.1381588_Самарская обл, Самара, поселок Зубчаниновка, ул Товарная, владение 56~18_698359_-161.0068491_Московская обл, Раменский р-н, Раменское, Северное шоссе, дом 10~19_747612_-169.0043759_Первоуральск, Свердловская обл., Россия, Динасовское шоссе, 3 км~20_950180_-152.9538339_Самарская обл, Самара, поселок Зубчаниновка, ул Товарная, дом 56~21_427431_-140.4809982_Тюмень, Тюменская обл., Россия, улица Магистральная, 12 корпус 1~22_417174_-151.4634004_Ленинградская обл, Тосненский р-н, деревня Трубников Бор, дом 1~23_942748_-146.1089218_Московская обл, Пушкино, ул Красноармейское шоссе, владение 105~24_573127_-147.2603009_Рязанская обл, Рязанский р-н, село Поляны, ул Терехина, дом 14~25_321190_-139.6209049_Респ Мордовия, Чамзинский р-н, село Большое Маресево, дом 27~26_329294_-155.8171794_Архангельская обл, Архангельск, ул Нагорная, дом 5 корпус 1~27_245258_-137.3466492_Ростовская обл, Аксайский р-н, Аксай, пр-кт Ленина, дом 44~28_282170_-148.7651143_Волгоградская обл, Волгоград, ул Социалистическая, дом 17~29_959467_-144.4548249_Ивановская обл, Иваново, ул Смирнова, дом 78А строение 14~30_198186_-158.3837184_Нижегородская обл, Нижний Новгород, ул Федосеенко, дом 43~31_456393_-133.9469600_Новосибирская обл, Новосибирск, ул Новосибирская, дом 127~32_922656_-154.7370818_Новосибирская обл, Новосибирск, ул Толмачевская, дом 43/4~33_877405_-158.2064998_проспект имени газеты Красноярский Рабочий, 27 строение 1~34_135876_-155.8171794_Малышева, Свердловская область, Россия, ул. Мичурина, 14~35_865606_-137.3466492_Ставропольский край, Кисловодск, ул Седлогорская, дом 11~36_759039_-156.0557918_Краноярский р-н, снт. Старая Бинорадка, улица 12, уч.3~37_457321_-137.4087262_Приморский край, Владивосток, Океанский пр-кт, дом 17~38_557014_-159.7303762_Санкт-Петербург, тер Старо-Паново, ул Земская, дом 88~39_704732_-130.5969238_Свердловская обл, Екатеринбург, пр-кт Ленина, дом 126~40_677463_-156.7677490_Хабаровский край, Хабаровск, ул Ленинградская, дом 9А~41_647104_-160.6165075_Краснодарский край, Новороссийск, ул Советов, дом 42~42_866140_-159.9303155_Красноярский край, Сосновоборск, ул Солнечная, дом 1~43_811827_-130.2906799_Новосибирская обл, Новосибирск, ул Планетная, дом 30~44_643649_-155.8171794_Респ Башкортостан, Уфа, ул Максима Рыльского, дом 23~45_148637_-137.3466492_Свердловская обл, Екатеринбург, ул Малышева, дом 122~46_951333_-155.6279768_Забайкальский край, Чита, ул Красной Звезды, дом 64~47_573059_-137.6519489_Сахалинская обл, Южно-Сахалинск, пр-кт Мира, дом 5В~48_986475_-159.8151442_Свердловская обл, Екатеринбург, пр-кт Ленина, дом 2~49_329195_-130.3838266_Хабаровский край, Хабаровск, ул Армавирская, дом 1Ш~50_871217_-153.2184038_Ивановская обл, Иваново, ул Марии Рябининой, дом 5~51_823334_-134.6519947_Кемеровская обл, Кемерово, Кузнецкий пр-кт, дом 35~52_559379_-155.6271618_Красноярский край, Красноярск, ул Взлетная, дом 57~53_256313_-137.6540518_Самара, Самарская, Россия, улица Красный Кряжок, 1~54_435827_-151.8079940_Свердловская обл, Екатеринбург, ул Огарева, дом 15~55_530711_-139.2022872_Амурская обл, Благовещенск, ул Чайковского, дом 2~56_861411_-155.5517477_Алтайский край, Барнаул, пр-кт Коммунаров, дом 2~57_130918_-137.7339172_Респ Калмыкия, Элиста, ул им А.И.Сусеева, дом 13~58_878972_-154.1567209_Санкт-Петербург, Лиговский пр-кт, дом 52 литер а~59_477457_-137.7227592_Московская обл, Дмитров, деревня Кузяево, дом 2~';

      <!-- var output = pako.gzip(input,{ to: 'string' }); -->
      <!-- console.log("output compressed gzip string - " + output); -->
      <!-- var eo = encodeURIComponent(output); -->
      <!-- console.log("encoded compressed gzip string - " + eo); -->
      <!-- var bo = btoa(output); -->
      <!-- var beo = encodeURIComponent(output); -->

      <!-- var deo = decodeURIComponent(eo); -->
      <!-- var originalInput = pako.ungzip(deo,{ to: 'string' }); -->
      <!-- console.log(input===originalInput); -->

      <!-- console.log("----"); -->
      <!-- console.log("input",input.length); -->
      <!-- console.log("output",output.length); -->
      <!-- console.log("eo",eo.length); -->
      <!-- console.log("btoa output",bo.length); -->

      //var example_input = 'POINT1+POINT2+....+POINTN';
      // POINT имеет вид: point_type|city_id|latitude|longitude|address

      <!-- var example_input = '1|1|||Гельсингфорсская, 2+5|270|||+2|135|-155.23244|54.342344|Ленина, 1'; -->
      <!-- var a1 = pako.gzip(example_input,{ to: 'string' }); -->
      <!-- var b1 = btoa(a1); -->
      <!-- var url = encodeURIComponent(b1); -->

      <!-- var c2 = decodeURIComponent(url); -->
      <!-- var b2 = atob(c2); -->
      <!-- var a2 = pako.ungzip(b2,{ to: 'string' }); -->

      var example_input =
        "1|1|||Гельсингфорсская, 2+5|270|||+2|135|-155.23244|54.342344|Ленина, 1";

      function createCodedParameters(str) {
        var a1 = pako.gzip(str, { to: "string" });
        var b1 = btoa(a1);
        var url = encodeURIComponent(b1);
        var c2 = decodeURIComponent(url);
        var b2 = atob(c2);
        var a2 = pako.ungzip(b2, { to: "string" });

        var z = str === a2;
        if (z) {
          return url;
        }
      }
      <!-- var unzipped_unbased_zipped_ex = pako.ungzip(decodeURIComponent(escape(unbased_zipped_ex)),{ to: 'string' }); -->
    </script>
  </head>
  <body>
    <div>
      Пиши сюда строку с параметрами, например,
      <code
        style="
          padding: 0 3px;
          background: rgb(39, 40, 34);
          border-radius: 2px;
          color: rgb(230, 219, 116);
        "
      >
        1|1|||Гельсингфорсская, 2+5|270|||+2|135|-55.23244|54.342344|Ленина, 1
      </code>
    </div>
    <input
      type="text"
      onchange="onInputChange(this.value)"
      style="width: 100%"
    />
    <div>Результат:</div>
    <textarea id="result" style="width: 100%"></textarea>
    <div id="links"></div>
    <script type="text/javascript">
      var resultElem = document.getElementById("result");
      var linksContainer = document.getElementById("links");

      function Domain(name, host) {
        this.name = name;
        this.host = host;
      }

      var domains = [
        new Domain("localhost", "localhost:3000"),
        new Domain("staging-1", "trace.ati.staging-1"),
        new Domain("staging-4", "trace.ati.staging-4"),
        new Domain("trace.ati.su", "trace.ati.su"),
      ];

      function renderLink(domain, encoded) {
        var href = `http://${domain.host}?Cities=${encoded}`;

        var link = document.createElement("a");
        link.setAttribute("href", href);
		link.setAttribute("target", "_blank");
        link.innerHTML = domain.name;

        return link.outerHTML;
      }

      function onInputChange(value) {
        var encoded = createCodedParameters(value);
        resultElem.value = encoded;
        var links = domains.map((domain) => renderLink(domain, encoded));
        linksContainer.innerHTML = links.join();
      }
    </script>
  </body>
</html>
